# Minisatip Bazel Configuration
#
# Feature flags (mirror configure.ac options):
#   --define dvbcsa=0/1      Enable/disable DVBCSA support (default: 1)
#   --define dvbca=0/1       Enable/disable CA/OpenSSL support (default: 1)
#   --define dvbapi=0/1      Enable/disable DVBAPI protocol (default: 1)
#   --define satipclient=0/1 Enable/disable SatIP client (default: 1)
#   --define linuxdvb=0/1    Enable/disable Linux DVB (default: 1)
#   --define ddci=0/1        Enable/disable DDCI (default: 1, requires dvbca)
#   --define netcvclient=0/1 Enable/disable Netceiver (default: 0, requires libs)
#   --define pmt=0/1         Enable/disable PMT processing (default: 1)
#   --define tables=0/1      Enable/disable TABLES processing (default: 1)
#
# Example usage:
#   bazel build //:minisatip                      # Full build
#   bazel build //:minisatip --define dvbcsa=0    # Without dvbcsa
#   bazel build --config=minimal //:minisatip     # Minimal build

# Build with C++20 by default
build --cxxopt=-std=c++20
build --host_cxxopt=-std=c++20

# Default feature flags - all enabled except netcvclient (requires special libs)
build --define dvbcsa=1
build --define dvbca=1
build --define dvbapi=1
build --define satipclient=1
build --define linuxdvb=1
build --define ddci=1
build --define netcvclient=0
build --define pmt=1
build --define tables=1

# Minimal configuration - disable all optional features
build:minimal --define dvbcsa=0
build:minimal --define dvbca=0
build:minimal --define dvbapi=0
build:minimal --define ddci=0
build:minimal --define netcvclient=0
build:minimal --define pmt=0
build:minimal --define tables=0

# CA-only configuration - OpenSSL/CA without dvbcsa
build:ca_only --define dvbcsa=0
build:ca_only --define dvbca=1
build:ca_only --define dvbapi=0
build:ca_only --define ddci=1
build:ca_only --define netcvclient=0
build:ca_only --define pmt=1
build:ca_only --define tables=1

# DVBCSA-only configuration - dvbcsa without CA/OpenSSL
build:dvbcsa_only --define dvbcsa=1
build:dvbcsa_only --define dvbca=0
build:dvbcsa_only --define dvbapi=0
build:dvbcsa_only --define ddci=0
build:dvbcsa_only --define netcvclient=0
build:dvbcsa_only --define pmt=1
build:dvbcsa_only --define tables=0

# Debug build
build:debug --compilation_mode=dbg
build:debug --cxxopt=-fsanitize=address
build:debug --cxxopt=-fsanitize=undefined
build:debug --linkopt=-fsanitize=address
build:debug --linkopt=-fsanitize=undefined

# Release/optimized build
build:release --compilation_mode=opt
build:release --cxxopt=-O2

# Static linking (note: requires static versions of system libraries)
build:static --linkopt=-static

#############################################################################
# Cross-compilation configurations
#############################################################################
# To cross-compile, you need the appropriate cross-compiler installed.
# Example: sudo apt install gcc-arm-linux-gnueabihf g++-arm-linux-gnueabihf
#
# Then build with: bazel build --config=arm //:minisatip

# ARM 32-bit (Raspberry Pi, etc.)
# Requires: arm-linux-gnueabihf-gcc
build:arm --platforms=//platforms:linux_arm
build:arm --compiler=arm-linux-gnueabihf-gcc
# build:arm --crosstool_top=//toolchains:arm_suite

# ARM 64-bit (aarch64)
# Requires: aarch64-linux-gnu-gcc
build:arm64 --platforms=//platforms:linux_arm64
build:arm64 --compiler=aarch64-linux-gnu-gcc

# MIPS (routers, set-top boxes)
# Requires: mips-linux-gnu-gcc or similar
build:mips --platforms=//platforms:linux_mips
